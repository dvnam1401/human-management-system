@page
@model human_management_system_fe.Pages.Email.SendModel
@{
    ViewData["Title"] = "Gửi Email";
}

<div class="row">
    <div class="col-md-8 mx-auto">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2><i class="bi bi-envelope-paper me-2"></i>Gửi Email Notification</h2>
            <a href="/Index" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left me-1"></i>Quay lại
            </a>
        </div>

        @if (!string.IsNullOrEmpty(Model.SuccessMessage))
        {
            <div class="alert alert-success alert-dismissible fade show" role="alert">
                <i class="bi bi-check-circle me-2"></i>
                @Model.SuccessMessage
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        }

        @if (!string.IsNullOrEmpty(Model.ErrorMessage))
        {
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                <i class="bi bi-exclamation-triangle me-2"></i>
                @Model.ErrorMessage
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        }

        <div class="card shadow-sm border-0">
            <div class="card-body p-4">
                <form method="post" id="sendEmailForm">
                    <div class="mb-3">
                        <label asp-for="EmailInput.RecipientEmail" class="form-label">
                            <i class="bi bi-envelope me-1"></i>Email người nhận
                            <span class="text-danger">*</span>
                        </label>
                        <input asp-for="EmailInput.RecipientEmail" type="email" class="form-control form-control-lg" 
                               placeholder="Nhập email người nhận" id="recipientEmail">
                        <span asp-validation-for="EmailInput.RecipientEmail" class="text-danger"></span>
                    </div>

                    <div class="mb-3">
                        <label asp-for="EmailInput.Subject" class="form-label">
                            <i class="bi bi-tag me-1"></i>Tiêu đề
                            <span class="text-danger">*</span>
                        </label>
                        <input asp-for="EmailInput.Subject" type="text" class="form-control form-control-lg" 
                               placeholder="Nhập tiêu đề email" id="subject">
                        <span asp-validation-for="EmailInput.Subject" class="text-danger"></span>
                    </div>

                    <div class="mb-3">
                        <label asp-for="EmailInput.Body" class="form-label">
                            <i class="bi bi-file-text me-1"></i>Nội dung
                            <span class="text-danger">*</span>
                        </label>
                        <textarea asp-for="EmailInput.Body" class="form-control" rows="10" 
                                  placeholder="Nhập nội dung email..." id="body"></textarea>
                        <span asp-validation-for="EmailInput.Body" class="text-danger"></span>
                        <small class="form-text text-muted">
                            <i class="bi bi-info-circle me-1"></i>
                            Bạn có thể sử dụng HTML trong nội dung email
                        </small>
                    </div>

                    <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>

                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-primary btn-lg" id="sendButton">
                            <i class="bi bi-send me-2"></i>Gửi Email
                        </button>
                        <button type="button" class="btn btn-outline-secondary" id="clearButton">
                            <i class="bi bi-x-circle me-2"></i>Xóa nội dung
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Email Templates (Optional) -->
        <div class="card shadow-sm border-0 mt-4">
            <div class="card-header bg-light">
                <h5 class="mb-0">
                    <i class="bi bi-file-earmark-text me-2"></i>Mẫu email nhanh
                </h5>
            </div>
            <div class="card-body">
                <div class="row g-2">
                    <div class="col-md-4">
                        <button class="btn btn-outline-primary w-100" onclick="useTemplate('welcome')">
                            <i class="bi bi-hand-thumbs-up me-1"></i>Chào mừng
                        </button>
                    </div>
                    <div class="col-md-4">
                        <button class="btn btn-outline-primary w-100" onclick="useTemplate('meeting')">
                            <i class="bi bi-calendar-event me-1"></i>Họp
                        </button>
                    </div>
                    <div class="col-md-4">
                        <button class="btn btn-outline-primary w-100" onclick="useTemplate('notification')">
                            <i class="bi bi-bell me-1"></i>Thông báo
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
    <script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>
    
    <script>
        $(document).ready(function() {
            // Clear form
            $('#clearButton').click(function() {
                if (confirm('Bạn có chắc muốn xóa tất cả nội dung?')) {
                    $('#sendEmailForm')[0].reset();
                    // Clear validation errors
                    $('.text-danger').empty();
                    $('.is-invalid').removeClass('is-invalid');
                }
            });

            // Auto-dismiss alerts after 5 seconds
            setTimeout(function() {
                $('.alert').fadeOut('slow');
            }, 5000);
        });

        function useTemplate(templateType) {
            const templates = {
                welcome: {
                    subject: 'Chào mừng bạn đến với HRMS',
                    body: `Xin chào,\n\nChúng tôi rất vui mừng chào đón bạn đến với hệ thống HRMS.\n\nNếu bạn có bất kỳ câu hỏi nào, vui lòng liên hệ với chúng tôi.\n\nTrân trọng,\nHRMS Team`
                },
                meeting: {
                    subject: 'Thông báo họp',
                    body: `Kính gửi,\n\nBạn được mời tham dự cuộc họp:\n\nThời gian: [Nhập thời gian]\nĐịa điểm: [Nhập địa điểm]\nNội dung: [Nhập nội dung]\n\nVui lòng xác nhận tham dự.\n\nTrân trọng,\nHRMS Team`
                },
                notification: {
                    subject: 'Thông báo quan trọng',
                    body: `Kính gửi,\n\nChúng tôi xin thông báo:\n\n[Nhập nội dung thông báo]\n\nVui lòng lưu ý thông tin trên.\n\nTrân trọng,\nHRMS Team`
                }
            };

            const template = templates[templateType];
            if (template) {
                $('#subject').val(template.subject);
                $('#body').val(template.body);
                $('#recipientEmail').focus();
            }
        }
    </script>

    <style>
        .card {
            border-radius: 12px;
        }

        textarea.form-control {
            resize: vertical;
            min-height: 200px;
        }

        .btn-outline-primary:hover {
            transform: translateY(-2px);
            transition: all 0.2s;
        }
    </style>
}

